<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
  <link rel="stylesheet" href="./static/css/style.css">
  <!-- Enlace al archivo CSS de Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <!-- Enlace al archivo JS de Flatpickr -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body>
  <div id="alert-container" style="display: none;">
    <p id="alert-message"></p>
  </div>
  <section>
    <span></span>
    <!-- Background Effect -->
<section> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> 
    
  <!-- Login Form -->
    <div class="signin" id="loginForm" style="display: block;">
      <div class="content">
          <h2>Ingrese su DNI</h2>
          <form action="/login" method="POST" class="form">
              <div class="inputBox">
                  <input type="text" name="dni" required>
                  <i>DNI</i>
              </div>
              <div class="inputBox">
                  <input type="submit" value="Ingresar">
              </div>
          </form>
          <div class="links">
              <a href="#" onclick="showSignup()">¿No tiene una cuenta? Registrarse</a>
          </div>
      </div>
  </div>
    

    <!-- Signup Form -->
    <div class="signin" id="signupTypeSelection" style="display: none;">
      <div class="content">
          <h2>Seleccione el tipo de usuario</h2>
          <div class="tipo-usuario">
              <button type="button" onclick="showRegistrationForm('jugador')" class="tipo-btn">Jugador</button>
              <button type="button" onclick="showRegistrationForm('dt')" class="tipo-btn">Director Técnico</button>
              <button type="button" onclick="showRegistrationForm('encargado')" class="tipo-btn">Encargado</button>
              <button type="button" onclick="showRegistrationForm('arbitro')" class="tipo-btn">Árbitro</button>
          </div>
          <div class="links">
              <a href="#" onclick="showLogin()">Ya tengo una cuenta</a>
          </div>
      </div>
  </div>
    
    <div class="signin" id="signupForm" style="display: none;">
      <div class="content">
        <h2>Registrarse</h2>
        <form action="/register" method="POST" class="form">
          <input type="hidden" name="tipo" id="tipoSeleccionado">
    
          <!-- Campos comunes -->
          <div class="inputBox">
            <input type="text" name="dni" required>
            <i>DNI</i>
          </div>
          <div class="inputBox">
            <input type="text" name="nombre" required>
            <i>Nombre</i>
          </div>
          <div class="inputBox">
            <input type="text" name="apellido" required>
            <i>Apellido</i>
          </div>
          <div class="inputBox">
          <input type="text" name="fecha_nacimiento" id="fecha_nacimiento" placeholder="AAAA-MM-DD" required>
          <label id="fecha_label">Fecha de Nacimiento</label>
        </div>
          <div class="inputBox">
            <input type="text" name="direccion" required>
            <i>Dirección</i>
          </div>
          <div class="inputBox">
            <input type="text" name="telefono" required>
            <i>Teléfono</i>
          </div>
    
          <!-- Campos específicos -->
          <div id="extraFields" style="margin-top: 20px;"></div>
    
          <div class="inputBox">
            <input type="submit" value="Registrarse">
          </div>
        </form>
        <div class="links">
          <a href="#" onclick="showTypeSelection()">Volver</a>
        </div>
      </div>
    </div>
  
    <script>
      function showRegistrationForm(type) {
        document.getElementById('tipoSeleccionado').value = type;

        const container = document.getElementById('extraFields');
        container.innerHTML = '';

        if (type === 'jugador') {
            container.innerHTML = `
                <div class="inputBox">
                    <input type="text" name="url_foto" required>
                    <i>URL Foto</i>
                </div>
                <div class="inputBox">
                    <label for="equipo">Selecciona un equipo:</label>
                    <select name="equipo" id="equipo" required>
                        <option value="">-- Selecciona un equipo --</option>
                    </select>
                </div>
            `;

            // Fetch equipos para el menú desplegable
            fetch('/register?tipo=jugador')
                .then(response => response.json())
                .then(data => {
                    const select = document.getElementById('equipo');
                    data.forEach(equipo => {
                        const option = document.createElement('option');
                        option.value = equipo.id;
                        option.textContent = equipo.nombre;
                        select.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error al cargar los equipos:', error);
                });
        } else if (type === 'dt') {
            container.innerHTML = `
                <div class="inputBox">
                    <input type="text" name="experiencia" required>
                    <i>Experiencia</i>
                </div>
            `;
        } else if (type === 'encargado') {
            container.innerHTML = `
                <div class="inputBox">
                    <input type="number" name="anios_experiencia" required>
                    <i>Años de Experiencia</i>
                </div>
            `;
        } else if (type === 'arbitro') {
            container.innerHTML = `
                <div class="inputBox">
                    <input type="text" name="nivel_experiencia" required>
                    <i>Nivel de Experiencia</i>
                </div>
                <div class="inputBox">
                    <label for="certificacion" style="color: #ddd; font-size: 0.9em;">Tiene Certificación</label>
                    <select name="tiene_certificacion" id="certificacion">
                        <option value="si">Sí</option>
                        <option value="no">No</option>
                    </select>
                </div>
            `;
        }

        // Cambiar a la vista del formulario
        document.getElementById('signupTypeSelection').style.display = 'none';
        document.getElementById('signupForm').style.display = 'block';
    }
    
      function showTypeSelection() {
        // Volver a la selección del tipo
        document.getElementById('signupForm').style.display = 'none';
        document.getElementById('signupTypeSelection').style.display = 'block';
      }
    </script>
  
  <script>
    
    function showSignup() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('signupTypeSelection').style.display = 'block'; 
      document.getElementById('signupForm').style.display = 'none'; 
    }

    function showLogin() {
      document.getElementById('loginForm').style.display = 'block'; 
      document.getElementById('signupTypeSelection').style.display = 'none'; 
      document.getElementById('signupForm').style.display = 'none'; 
    }
    
  </script>

  <script>
   // Evento para manejar el registro con AJAX
document.querySelector('#signupForm form').addEventListener('submit', function (event) {
  event.preventDefault(); // Prevenir el envío estándar del formulario

  const form = event.target;
  const formData = new FormData(form);

  fetch('/register', {
      method: 'POST',
      body: formData,
  })
      .then(response => response.json())
      .then(data => {
          if (data.error) {
              alert(data.error); // Muestra una alerta nativa con el mensaje de error
          } else if (data.success) {
              alert(data.success); // Muestra una alerta nativa con el mensaje de éxito
              window.location.href = '/login'; // Redirigir si el registro fue exitoso
          }
      })
      .catch(err => {
          alert('Error inesperado. Por favor, inténtelo de nuevo.');
          console.error(err);
      });
});
  </script>
</body>
</html>
